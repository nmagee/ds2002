<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>CS4740 Cloud Computing - EC2 Bootstrapping Lab</title>

    <link rel="stylesheet" href="https://nmagee.github.io/cs4740/stylesheets/styles.css">
    <link rel="stylesheet" href="https://nmagee.github.io/cs4740/stylesheets/github-light.css">
    <link rel="Shortcut Icon" href="https://www.rc.virginia.edu/images/favicon.ico" type="image/x-icon" />
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <style>
      li {margin-bottom:1rem;}
      .btn {padding:8px;margin-right:8px;background-color:#555;color:white;border-radius: 4px;}
    </style>

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="https://nmagee.github.io/cs4740/" style="color:black;text-decoration:none;">CS4740 Cloud Computing</a></h1>
        <p>Neal Magee, Ph.D.<br />Solution Architect, Research Computing<br />University of Virginia, Fall 2020</p>

        <div style="min-height:2rem;"></div>

        <ul>
          <li><a href="https://nmagee.github.io/cs4740/">Return to the<strong>Syllabus</strong></a></li>
          <li><a href="https://l.uvarc.io/youtube-lectures" target="_new">View lectures<strong>YouTube</strong></a></li>
          <li><a href="https://l.uvarc.io/discord">Discussions on <strong>Discord</strong></a></li>
        </ul>
      </header>
      <section>
        
<h2>Lab: Auto-scaling in EC2</h2>

<p>Auto-scaling is the process of automating the scale-out of an application stack within Amazon EC2. Such a scale-out can be triggered manually,
or based upon aggregate metrics across the existing stack.</p>

<p>For instance, a very common scenario for web applications running in Apache2 or nginx is to watch CPU across running instances. If a CPU threshold (75% for example) is exceeded
  for more than 5 minutes, then a scaling event is invoked and 1 or more instances are added to the application load balancer. Conversely, the opposite scaling event is invoked
  when that condition goes away. So CPU threshold may return to below 75% and, after a given time (10 minutes for example) the stack is scaled back down incrementally.
</p>

<p>From the EC2 Autoscaling service:
  <blockquote>
    Amazon EC2 Auto Scaling helps you maintain application availability and allows you to automatically add or remove EC2 instances according to conditions you define. You can use the fleet management features of EC2 Auto Scaling to maintain the health and availability of your fleet. You can also use the dynamic and predictive scaling features of EC2 Auto Scaling to add or remove EC2 instances. Dynamic scaling responds to changing demand and predictive scaling automatically schedules the right number of EC2 instances based on predicted demand. Dynamic scaling and predictive scaling can be used together to scale faster. 
  </blockquote>
</p>

<p>This lab introduces the basics of EC2 auto-scaling.</p> 

<h3>Concepts and Requirements</h3>
<ol>
  <li>In order to deploy an auto-scaling group you will need the following:
    <ul>
      <li>An instance AMI that is ready to provision with your application (either bootstrapped or built into the AMI)
      <li>A <b>Launch Configuration</b> that specifies the AMI for your application, the instance type you wish to launch, storage, security groups, key pairs, etc.
        The Launch Configuration defines the basic parameters of each new instance added to your application stack.
      <li>Finally, an Auto Scaling Group defines your running application and its properties, such as default group size, notifications, and scaling conditions.
    </ul>
  </li>
  <li>For the purposes of this lab we will use a special AMI I created that is highly inefficient in CPU usage. <code>;^)</code>  This will allow us to imitate an app server under heavy load. 
  <li>Once deployed, we will use the <code>siege</code> command-line load simulation and testing tool to put your auto-scaling group under heavier load and verify that scaling occurs.</li>
</ol>


1. Create security group
2. Get AMI you want - ami-02354e95b39ca8dec w/ bootstrapping
3. Create launch configuration
4. Create ASG
5. Test and terminate and watch



<h3>Create a Launch Configuration</h3>
<ol>
<li>Final notes: <br /><br />
    <ul>
      <li></li>
      <li></li>
      <li></li>
    </ul>
  </li>
</ol>

<h3>Create an Auto Scaling Group</h3>
<ol>
<li>Final notes: <br /><br />
    <ul>
      <li></li>
      <li></li>
      <li></li>
    </ul>
  </li>
</ol>

<h3>Put your App Under Heavy Load</h3>
<ol>
  <li>Create a new t2.nano EC2 instance and SSH into it.</li>
  <li>Install the <code>siege</code> command-line tool using yum, apt, or apk.</li> 
  <li>Using the CNAME of the Elastic Load Balancer for your auto scaling group, run a siege attack against your app. This will simulate 50 concurrent users hitting your site steadily for 5 sets of requests: <br /><br />
<pre>
  siege -c50 -r5 -d5 http://your-app-load-balancer-cname/
</pre>
  </li>
  <li>While <code>siege</code> is running, go back to your Auto Scaling Group and watch the metrics using the "Monitoring" tab. Refresh the screen to see the number of nodes increase under load.</li>
</ol>

      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/nmagee">nmagee</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="https://nmagee.github.io/cs4740/javascripts/scale.fix.js"></script>
    
  </body>
</html>
